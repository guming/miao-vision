# SQL Workspace 产品改进 TODO

**评估日期**: 2024-12-24
**视角**: 产品经理
**当前版本**: 基础功能完整，缺少高级特性

---

## 📊 当前功能盘点

### ✅ 已有功能
- 多标签 SQL 编辑器 (Monaco Editor)
- SQL 自动补全 (基于表结构)
- 查询执行 (全部/选中)
- 查询历史记录 (成功/失败追踪)
- 数据浏览器侧边栏 (可折叠)
- 文件上传 (CSV, Parquet, JSON)
- 结果面板:
  - 表格视图 (排序、筛选、分页)
  - 图表视图
  - 列选择器
  - 列统计信息
  - 快速洞察
  - 搜索和过滤

### ⚠️ 体验痛点
1. 查询不能持久化保存 (只有会话历史)
2. 无法导出查询结果
3. 没有查询模板/代码片段
4. 标签页命名不直观 (Query 1, Query 2)
5. 无法取消执行中的查询
6. 大数据量查询没有限制提示
7. 没有新手引导

---

## 🔴 P0 - 核心功能缺失 (Critical)

### 1. 查询结果导出
**问题**: 用户无法导出查询结果，只能截图或手动复制
**影响**: 严重影响数据分析工作流
**优先级**: 🔴 P0

**需求**:
- [ ] 导出为 CSV
- [ ] 导出为 Excel (XLSX)
- [ ] 导出为 JSON
- [ ] 复制到剪贴板 (支持 Excel 格式)
- [ ] 仅导出可见列
- [ ] 导出全部数据 vs 当前页

**工作量**: ~4-6 hours
**价值**: 高 - 核心工作流
**技术**: 可复用 DataTable 的 export.ts 逻辑

---

### 2. 查询持久化保存
**问题**: 关闭浏览器后，只保留SQL文本，结果丢失；没有"保存为"功能
**影响**: 无法保存重要查询供后续使用
**优先级**: 🔴 P0

**需求**:
- [ ] 保存查询 (名称 + SQL + 描述)
- [ ] 查询列表管理 (重命名、删除、搜索)
- [ ] 从保存的查询加载
- [ ] 查询分类/文件夹
- [ ] 标记星标查询
- [ ] 查询导出/导入 (JSON)

**工作量**: ~8-10 hours
**价值**: 高 - 提升复用性
**UI位置**: DataExplorer 侧边栏新增 "Saved Queries" 标签

---

### 3. 查询取消功能
**问题**: 长查询无法中断，用户只能等待或刷新页面
**影响**: 误操作导致性能问题
**优先级**: 🔴 P0

**需求**:
- [ ] 添加 "Cancel" 按钮
- [ ] 取消执行中的查询
- [ ] 显示查询已取消状态
- [ ] 清理未完成的查询资源

**工作量**: ~3-4 hours
**价值**: 中 - 安全性保障
**技术**: DuckDB WASM 支持查询中断

---

### 4. 标签页命名优化
**问题**: "Query 1", "Query 2" 无法区分内容
**影响**: 多标签时难以找到目标查询
**优先级**: 🔴 P0

**需求**:
- [ ] 点击标签名可编辑
- [ ] 自动从 SQL 提取标题 (第一行注释或 SELECT 目标)
- [ ] 显示标签修改状态 (未保存 *)
- [ ] 标签右键菜单 (重命名、复制、关闭其他)

**工作量**: ~2-3 hours
**价值**: 中 - 可用性提升

---

## 🟡 P1 - 重要体验优化 (Important)

### 5. SQL 代码片段/模板
**问题**: 常用SQL模式需要反复手写
**影响**: 降低效率
**优先级**: 🟡 P1

**需求**:
- [ ] 内置SQL模板库
  - `SELECT * FROM table LIMIT 10`
  - `DESCRIBE table`
  - `SELECT COUNT(*) GROUP BY column`
  - 等等
- [ ] 自定义代码片段
- [ ] 快捷键插入 (如 `Ctrl+Space` 触发)
- [ ] 变量占位符 (如 `{{table_name}}`)

**工作量**: ~6-8 hours
**价值**: 高 - 效率提升
**参考**: VSCode Snippets 功能

---

### 6. 查询性能提示
**问题**: 用户不知道查询会返回多少数据，可能执行危险查询
**影响**: 性能问题、浏览器崩溃
**优先级**: 🟡 P1

**需求**:
- [ ] 检测无 LIMIT 的查询，显示警告
- [ ] 估算结果行数 (基于 COUNT)
- [ ] 显示查询执行计划 (EXPLAIN)
- [ ] 自动添加安全LIMIT (可配置，如 10000 行)
- [ ] 超大结果集警告弹窗

**工作量**: ~4-5 hours
**价值**: 中 - 安全性

---

### 7. 表数据快速预览
**问题**: 必须写 SQL 才能查看表数据
**影响**: 探索性分析不便
**优先级**: 🟡 P1

**需求**:
- [ ] DataExplorer 中右键表名 → "Preview" (前100行)
- [ ] 显示表基本信息 (行数、大小、创建时间)
- [ ] 点击列名插入到 SQL
- [ ] 快速筛选 (WHERE 条件生成器)

**工作量**: ~5-6 hours
**价值**: 高 - 探索性分析
**UI**: Modal 或 右侧面板

---

### 8. 键盘快捷键帮助
**问题**: 用户不知道支持哪些快捷键
**影响**: 低效使用
**优先级**: 🟡 P1

**需求**:
- [ ] 快捷键帮助面板 (按 `?` 或 `Cmd+/` 触发)
- [ ] 显示所有快捷键:
  - `Cmd+Enter` - 执行查询
  - `Cmd+Shift+Enter` - 执行选中
  - `Cmd+T` - 新建标签
  - `Cmd+W` - 关闭标签
  - `Cmd+S` - 保存查询 (待实现)
  - `Cmd+F` - 查找
  - `Cmd+/` - 注释
- [ ] 可自定义快捷键

**工作量**: ~2-3 hours
**价值**: 中 - 可发现性

---

### 9. 结果可视化增强
**问题**: 图表功能基础，缺少交互
**影响**: 数据洞察有限
**优先级**: 🟡 P1

**需求**:
- [ ] 图表类型扩展 (目前只有 Bar/Line/Scatter)
  - Pie Chart
  - Area Chart
  - Bubble Chart (已有组件，待集成)
  - Heatmap
- [ ] 图表配置保存
- [ ] 图表导出 (PNG/SVG)
- [ ] 图表添加到 Report (一键)
- [ ] 图表交互 (点击筛选、缩放)

**工作量**: ~8-10 hours
**价值**: 高 - 数据可视化

---

### 10. 空状态优化
**问题**: 新用户不知道如何开始
**影响**: 学习曲线陡峭
**优先级**: 🟡 P1

**需求**:
- [ ] 首次使用引导 (Tour.js)
  1. 上传文件
  2. 查看表结构
  3. 编写查询
  4. 执行并查看结果
  5. 保存查询
- [ ] 空状态改进
  - 无表时: "Upload a file to get started"
  - 无查询结果时: "Run a query to see results"
  - 查询历史为空时: 示例查询按钮
- [ ] 示例数据集 (Sample data)
  - 内置 Iris 数据集
  - 内置 Sales 数据集

**工作量**: ~6-8 hours
**价值**: 高 - 新手友好度

---

## 🟢 P2 - 高级特性 (Nice to Have)

### 11. SQL 格式化
**问题**: Format 按钮存在但未实现
**影响**: 代码可读性差
**优先级**: 🟢 P2

**需求**:
- [ ] 实现 SQL 格式化 (使用 sql-formatter 库)
- [ ] 自定义格式化规则 (缩进、大小写)
- [ ] 自动格式化选项

**工作量**: ~2-3 hours
**价值**: 中
**技术**: https://github.com/sql-formatter-org/sql-formatter

---

### 12. 查询对比
**问题**: 无法对比两个查询结果的差异
**影响**: A/B测试困难
**优先级**: 🟢 P2

**需求**:
- [ ] 选择两个查询结果
- [ ] 并排显示
- [ ] 高亮差异
- [ ] 导出对比报告

**工作量**: ~6-8 hours
**价值**: 中

---

### 13. 数据质量检查
**问题**: 无法快速了解数据质量
**影响**: 需要手动编写检查SQL
**优先级**: 🟢 P2

**需求**:
- [ ] 一键数据质量报告
  - NULL 值统计
  - 重复值检测
  - 数据类型一致性
  - 异常值检测 (outliers)
- [ ] 可视化数据质量分数

**工作量**: ~10-12 hours
**价值**: 中 - 数据分析

---

### 14. 分屏/布局调整
**问题**: 编辑器和结果固定比例，无法调整
**影响**: 小屏幕体验差
**优先级**: 🟢 P2

**需求**:
- [ ] 拖动分隔线调整编辑器/结果面板比例
- [ ] 保存布局偏好
- [ ] 全屏模式 (结果或编辑器)
- [ ] 侧边栏宽度可调

**工作量**: ~4-5 hours
**价值**: 中
**技术**: react-split-pane 或类似库 (Svelte版本)

---

### 15. 查询版本控制
**问题**: 无法回退到之前的查询版本
**影响**: 误操作无法恢复
**优先级**: 🟢 P2

**需求**:
- [ ] 自动保存查询历史版本
- [ ] 显示版本差异 (Diff)
- [ ] 回退到任意版本
- [ ] 版本备注

**工作量**: ~8-10 hours
**价值**: 中

---

### 16. AI 辅助查询
**问题**: 复杂 SQL 编写困难
**影响**: 依赖 SQL 技能
**优先级**: 🟢 P2

**需求**:
- [ ] 自然语言转SQL (NL2SQL)
  - "Show me top 10 products by revenue"
  - → `SELECT product, SUM(revenue) FROM ... GROUP BY product ORDER BY SUM(revenue) DESC LIMIT 10`
- [ ] SQL 解释 (Explain in plain English)
- [ ] SQL 优化建议
- [ ] 错误修复建议

**工作量**: ~20-30 hours (集成 LLM API)
**价值**: 高 - 降低门槛
**技术**: OpenAI API / Claude API

---

## 🔵 P3 - 协作功能 (Future)

### 17. 查询分享
**问题**: 无法与团队分享查询
**影响**: 协作困难
**优先级**: 🔵 P3

**需求**:
- [ ] 生成分享链接 (只读)
- [ ] 嵌入查询到报告
- [ ] 查询权限管理

**工作量**: ~15-20 hours
**价值**: 高 - 协作

---

### 18. 团队共享查询库
**问题**: 每个人维护自己的查询
**影响**: 重复工作
**优先级**: 🔵 P3

**需求**:
- [ ] 组织级查询库
- [ ] 查询分类和标签
- [ ] 查询评分和评论
- [ ] 查询使用统计

**工作量**: ~20-30 hours
**价值**: 高 - 知识沉淀

---

## 🔵 P4 - 性能优化

### 19. 大数据集优化
**问题**: 大数据集渲染卡顿
**影响**: >10万行数据时体验差
**优先级**: 🔵 P4

**需求**:
- [ ] 虚拟滚动优化 (目前已有，继续优化)
- [ ] 结果流式加载
- [ ] 分块渲染
- [ ] Web Worker 处理数据

**工作量**: ~8-10 hours
**价值**: 中 - 性能

---

### 20. 查询智能缓存
**问题**: 相同查询重复执行
**影响**: 浪费资源
**优先级**: 🔵 P4

**需求**:
- [ ] 缓存查询结果 (基于 SQL hash)
- [ ] 缓存失效策略
- [ ] 显示缓存命中提示
- [ ] 清除缓存选项

**工作量**: ~6-8 hours
**价值**: 中

---

## 📊 实施优先级矩阵

| 功能 | 优先级 | 价值 | 工作量 | ROI |
|------|--------|------|--------|-----|
| 结果导出 | P0 | 高 | 中 | ⭐⭐⭐⭐⭐ |
| 查询保存 | P0 | 高 | 中 | ⭐⭐⭐⭐⭐ |
| 查询取消 | P0 | 中 | 低 | ⭐⭐⭐⭐ |
| 标签命名 | P0 | 中 | 低 | ⭐⭐⭐⭐ |
| SQL 代码片段 | P1 | 高 | 中 | ⭐⭐⭐⭐ |
| 性能提示 | P1 | 中 | 中 | ⭐⭐⭐ |
| 表快速预览 | P1 | 高 | 中 | ⭐⭐⭐⭐ |
| 快捷键帮助 | P1 | 中 | 低 | ⭐⭐⭐ |
| 可视化增强 | P1 | 高 | 高 | ⭐⭐⭐ |
| 空状态优化 | P1 | 高 | 中 | ⭐⭐⭐⭐ |
| SQL 格式化 | P2 | 中 | 低 | ⭐⭐⭐ |
| 查询对比 | P2 | 中 | 中 | ⭐⭐ |
| 数据质量检查 | P2 | 中 | 高 | ⭐⭐ |
| 分屏调整 | P2 | 中 | 中 | ⭐⭐⭐ |
| 版本控制 | P2 | 中 | 高 | ⭐⭐ |
| AI 辅助 | P2 | 高 | 高 | ⭐⭐⭐ |

---

## 🎯 建议实施路线图

### Sprint 1 (Week 1-2): 核心功能完善
**目标**: 解决最严重的用户痛点

- [x] P0-1: 结果导出 (CSV/Excel/JSON)
- [x] P0-2: 查询持久化保存
- [x] P0-3: 查询取消功能
- [x] P0-4: 标签页命名优化

**预期收益**: 核心工作流完整，用户满意度 +30%

---

### Sprint 2 (Week 3-4): 效率提升
**目标**: 提升高频操作效率

- [ ] P1-5: SQL 代码片段
- [ ] P1-6: 查询性能提示
- [ ] P1-7: 表数据快速预览
- [ ] P1-8: 键盘快捷键帮助

**预期收益**: 操作效率 +40%

---

### Sprint 3 (Week 5-6): 可视化与引导
**目标**: 降低学习曲线，增强洞察

- [ ] P1-9: 结果可视化增强
- [ ] P1-10: 空状态优化 + 新手引导
- [ ] P2-11: SQL 格式化
- [ ] P2-14: 分屏调整

**预期收益**: 新手上手时间 -50%，数据洞察质量 +25%

---

### Sprint 4+ (Long-term): 高级特性
**目标**: 差异化竞争力

- [ ] P2-16: AI 辅助查询 (战略重点)
- [ ] P2-13: 数据质量检查
- [ ] P3-17: 查询分享
- [ ] P3-18: 团队查询库

---

## 🏆 竞品对比

| 功能 | Miaoshou Vision (当前) | Metabase | Redash | Mode Analytics |
|------|------------------------|----------|--------|----------------|
| SQL 编辑器 | ✅ Monaco | ✅ Ace | ✅ CodeMirror | ✅ |
| 查询保存 | ❌ | ✅ | ✅ | ✅ |
| 结果导出 | ❌ | ✅ | ✅ | ✅ |
| 可视化 | ⚠️ 基础 | ✅ 丰富 | ✅ | ✅ |
| 分享 | ❌ | ✅ | ✅ | ✅ |
| AI 辅助 | ❌ | ❌ | ❌ | ⚠️ 部分 |
| 本地优先 | ✅ | ❌ | ❌ | ❌ |

**差异化优势**:
- ✅ 完全本地运行 (DuckDB WASM)
- ✅ Markdown 报告集成
- ✅ 无需服务器部署

**待补齐**:
- ❌ 查询保存和管理
- ❌ 结果导出
- ❌ 协作功能

---

## 📝 结论

**总体评价**:
- ✅ 核心 SQL 功能完整，Monaco 编辑器体验好
- ✅ 结果展示功能丰富 (表格、图表、统计)
- ⚠️ **关键功能缺失**: 查询保存、结果导出
- ⚠️ 缺少新手引导和效率工具
- ❌ 无协作功能

**产品定位建议**:
1. **短期 (1-2月)**: 补齐核心功能 (导出、保存、取消)，达到"可用"
2. **中期 (3-6月)**: 优化效率和体验，达到"好用"
3. **长期 (6月+)**: AI辅助和协作，达到"领先"

**最关键的 3 个改进**:
1. 🔴 **结果导出** - 没有导出功能，用户无法完成数据分析闭环
2. 🔴 **查询保存** - 无法积累和复用查询，每次重复劳动
3. 🟡 **新手引导** - 学习曲线陡峭，影响产品采用

**建议立即启动 Sprint 1 (P0 功能)**，预计 2 周可完成核心补齐。
